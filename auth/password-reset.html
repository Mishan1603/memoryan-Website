<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Reset - Memoryan</title>
    <meta name="description" content="Reset your Memoryan account password securely">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../images/memoryan-logo.png">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="auth-styles.css">
        <style>
          .auth-password-wrapper { display: flex; align-items: center; gap: 8px; }
          .auth-password-toggle { cursor: pointer; padding: 8px 10px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color: #fff; }
          .auth-password-toggle:hover { background: rgba(255,255,255,0.12); }
          /* Ensure blocking overlay looks intentional */
          #auth-loading.blocking-overlay { backdrop-filter: blur(6px); }
        </style>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Animated Gradient Background -->
    <div class="animated-gradient"></div>

    <!-- Auth Header -->
    <header class="auth-header glass-panel">
        <a href="https://mymemoryan.com" class="auth-logo-link" title="Home">
            <img src="../images/memoryan-logo.png" alt="Memoryan Logo" class="auth-logo">
            <span class="auth-title">Memoryan</span>
        </a>
        <div class="language-selector">
            <button id="language-button" class="language-button">
                <span id="current-language">EN</span>
            </button>
            <div id="language-dropdown" class="language-dropdown">
                <a href="#" data-lang="en" class="language-option">English</a>
                <a href="#" data-lang="ru" class="language-option">Русский</a>
                <a href="#" data-lang="uk" class="language-option">Українська</a>
                <a href="#" data-lang="de" class="language-option">Deutsch</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="auth-main-container">
        <div class="auth-form-container">
            <!-- No back hub; home is in header -->

            <!-- Password Reset Form -->
            <div class="auth-form">
                <div id="password-reset-content">
                    <!-- Step 1: Enter Email -->
                    <div id="email-section">
                        <h1 data-i18n="passwordReset.title">Reset Your Password</h1>
                        <p class="auth-description" data-i18n="passwordReset.emailIntro">
                            Enter your account email to start the password reset process.
                        </p>
                        <form id="email-form">
                            <div class="auth-form-group">
                                <label for="reset-email" class="auth-form-label" data-i18n="common.emailAddress">Email Address</label>
                                <input type="email" id="reset-email" name="email" class="auth-form-input" 
                                    data-i18n-placeholder="common.enterEmailPlaceholder" placeholder="Enter your email address" 
                                    required autocomplete="email" value="">
                            </div>
                            <button type="submit" class="auth-form-button" id="continue-to-otp-btn" data-i18n="passwordReset.continueButton">
                                Continue
                            </button>
                        </form>
                    </div>

                    <!-- Step 2: Request OTP (email is already provided in Step 1) -->
                    <div id="request-otp-section" style="display: none;">
                        <h1 data-i18n="passwordReset.requestCode">Get Your Reset Code</h1>
                        <p class="auth-description">
                            <span data-i18n="passwordReset.codeWillBeSent">We will send a 6-digit code to:</span>
                            <strong id="user-email-display"></strong>
                        </p>
                        <form id="request-otp-form">
                            <button type="submit" class="auth-form-button" id="send-otp-btn" data-i18n="passwordReset.receiveOTP">
                                Receive Reset Code
                            </button>
                        </form>
                    </div>

                    <!-- Step 3: Enter OTP -->
                    <div id="enter-otp-section" style="display: none;">
                        <h1 data-i18n="passwordReset.enterCodeTitle">Enter Reset Code</h1>
                        <p class="auth-description">
                            <span data-i18n="passwordReset.codeSentTo">We sent a 6-digit code to</span> 
                            <strong id="otp-email"></strong>. 
                            <span data-i18n="passwordReset.enterBelow">Please enter it below.</span>
                        </p>
                        <form id="verify-otp-form">
                            <div class="auth-form-group">
                                <label for="otp-input" class="auth-form-label" data-i18n="passwordReset.sixDigitCode">6-Digit Code</label>
                                <input type="text" id="otp-input" name="otp" class="auth-form-input" 
                                    data-i18n-placeholder="passwordReset.enterOTP" placeholder="—  —  —  —  —  —" 
                                    required maxlength="6" pattern="\d{6}" inputmode="numeric" autocomplete="one-time-code">
                                <p id="remaining-attempts" class="attempts-info" style="display: none;"></p>
                            </div>
                            <button type="submit" class="auth-form-button" id="verify-otp-btn" data-i18n="passwordReset.verifyCode">
                                Verify Code
                            </button>
                        </form>
                        <p class="auth-secondary-link">
                            <a href="#" id="resend-otp-link" data-i18n="passwordReset.resendCode">Resend Code</a>
                        </p>
                    </div>

                    <!-- Step 4: New Password Form -->
                    <div id="new-password-section" style="display: none;">
                        <h1 data-i18n="passwordReset.setNewPassword">Set New Password</h1>
                        <p class="auth-description" data-i18n="passwordReset.passwordDescription">
                            Create a strong password with at least 8 characters.
                        </p>
                        <form id="new-password-form">
                            <div class="auth-form-group">
                                <label for="new-password" class="auth-form-label" data-i18n="passwordReset.newPassword">New Password</label>
                                 <div class="auth-password-wrapper">
                                   <input type="password" id="new-password" name="password" class="auth-form-input" 
                                    data-i18n-placeholder="passwordReset.enterNewPassword" placeholder="Enter your new password" 
                                     required minlength="8" autocomplete="new-password">
                                   <button type="button" id="toggle-new-password" class="auth-password-toggle" aria-label="Show password">Show</button>
                                 </div>
                            </div>
                            <div class="auth-form-group">
                                <label for="confirm-password" class="auth-form-label" data-i18n="passwordReset.confirmPassword">Confirm Password</label>
                                 <div class="auth-password-wrapper">
                                   <input type="password" id="confirm-password" name="confirmPassword" class="auth-form-input" 
                                    data-i18n-placeholder="passwordReset.confirmNewPassword" placeholder="Confirm your new password" 
                                     required minlength="8" autocomplete="new-password">
                                   <button type="button" id="toggle-confirm-password" class="auth-password-toggle" aria-label="Show password">Show</button>
                                 </div>
                            </div>
                            <button type="submit" class="auth-form-button" id="update-password-btn" data-i18n="passwordReset.updatePassword">
                                Update Password
                            </button>
                        </form>
                    </div>

                    <!-- Step 5: Success Confirmation -->
                    <div id="password-updated-section" style="display: none;">
                        <div class="auth-success-container">
                            <div class="success-icon">✓</div>
                            <h2 data-i18n="passwordReset.success">Password Updated!</h2>
                            <p class="auth-description" data-i18n="passwordReset.successMessage">
                                Your password has been changed successfully. You can now sign in with your new password.
                            </p>
                            <a href="https://mymemoryan.com" class="auth-form-button" data-i18n="common.returnToHome">Return to Home</a>
                        </div>
                    </div>

                    <!-- Error State Display -->
                    <div id="error-display" style="display: none;"></div>
                </div>
            </div>

            <!-- Security Information -->
            <div class="auth-security-notice">
                <div class="security-icon">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M12,7C13.4,7 14.8,8.6 14.8,10V11H16V16H8V11H9.2V10C9.2,8.6 10.6,7 12,7M12,8.2C11.2,8.2 10.4,8.7 10.4,10V11H13.6V10C13.6,8.7 12.8,8.2 12,8.2Z"/>
                    </svg>
                </div>
                <div class="security-content">
                    <h3 data-i18n="passwordReset.secureReset">Secure Password Reset</h3>
                    <p data-i18n="passwordReset.securityInfo">
                        Password reset codes are time-limited and single-use for maximum security. 
                        Your new password is encrypted before being stored.
                    </p>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="auth-footer glass-panel">
        <div class="auth-footer-content">
            <p>&copy; 2024 Memoryan. All rights reserved.</p>
            <div class="auth-footer-links">
                <a href="../privacy-policy.html" data-i18n="common.privacyPolicy">Privacy Policy</a>
                <a href="../terms-of-service.html" data-i18n="common.termsOfService">Terms of Service</a>
                <a href="../index.html" data-i18n="common.backToWebsite">Back to Website</a>
            </div>
        </div>
    </footer>

    <!-- Loading Indicator -->
    <div id="auth-loading" class="auth-loading-overlay" style="display: none;">
        <div class="auth-loading-spinner"></div>
        <p id="loading-text" data-i18n="common.processing">Processing request...</p>
    </div>

    <!-- Scripts -->
    <script src="../js/config.js"></script>
    <script src="../js/supabase-loader.js"></script>
    <script src="../js/i18n.js"></script>
    <script src="js/auth-core.js"></script>
    <script src="js/password-reset.js"></script>
    <script>
      // Toggle password visibility buttons
      document.addEventListener('DOMContentLoaded', function() {
        function attachToggle(btnId, inputId) {
          const btn = document.getElementById(btnId);
          const input = document.getElementById(inputId);
          if (!btn || !input) return;
          btn.addEventListener('click', function() {
            const isPwd = input.getAttribute('type') === 'password';
            input.setAttribute('type', isPwd ? 'text' : 'password');
            btn.textContent = isPwd ? 'Hide' : 'Show';
          });
        }
        attachToggle('toggle-new-password', 'new-password');
        attachToggle('toggle-confirm-password', 'confirm-password');
      });
    </script>
</body>
</html> 